/**
 * taurus-serv-cuenta - v1.8.0-build.12 - 2017-06-27
 * Copyright (c) 2017 
 */

!function(){angular.module("WebBancoChile",["angular-loading-bar","ngAnimate","templates-app","templates-common","templates-orion","templates-taurus","ui.bootstrap","ui.bootstrap.dropdown","ui.bootstrap.modal","ui.router","ui.select","ui.utils","WebBancoChile.constants","WebBancoChile.filters","WebBancoChile.home","WebBancoChile.infoCliente","WebBancoChile.jwt","WebBancoChile.orionTablas","WebBancoChile.menuAside","WebBancoChile.ngEnter","WebBancoChile.ngNumber","WebBancoChile.ngPaginator","WebBancoChile.ngRut","WebBancoChile.servCheques","WebBancoChile.showIfAuthorized","WebBancoChile.cajaDescargaDocumento","WebBancoChile.servCuenta","WebBancoChile.servDocumentos"])}(),function(){angular.module("WebBancoChile.menuAside",["ui.router","ui.bootstrap","WebBancoChile.constants"])}(),function(){angular.module("WebBancoChile.servCuenta",["ngAnimate","ui.bootstrap","ui.bootstrap.modal","ui.router","ui.select","WebBancoChile.blockView","WebBancoChile.constants","WebBancoChile.constantsTransferencias","WebBancoChile.filters","WebBancoChile.ngDate","WebBancoChile.ngEnter","WebBancoChile.ngPaginator","WebBancoChile.ngRut","WebBancoChile.orionTablas","WebBancoChile.descargarPdf","WebBancoChile.errorHandler","WebBancoChile.onlyNumberDirective","WebBancoChile.fechaUtil","WebBancoChile.ordenNoPago","angular-svg-round-progress","WebBancoChile.cajaDescargaDocumento","WebBancoChile.bloqueoCuentaLinea","WebBancoChile.listaSucursalesDirective","WebBancoChile.servCheques","WebBancoChile.servSaldosMvtosCuenta","WebBancoChile.servDocumentos"])}(),function(){angular.module("WebBancoChile.home",["ui.router","ui.bootstrap","WebBancoChile.constants"])}(),function(){function myAppConfig($stateProvider,$urlRouterProvider,$animateProvider,$httpProvider,$logProvider,cfpLoadingBarProvider){function getUserProfile(){return["$q","$window","$timeout","$rootScope","PerfilUsuarioService",function($q,$window,$timeout,$rootScope,PerfilUsuarioService){var defer=$q.defer();return PerfilUsuarioService.getUserProfile().then(function(data){$window.localStorage.perfilusuario=JSON.stringify(data),defer.resolve(data)},function(err){defer.reject(err)}),defer.promise}]}function getCliente(){return["$q","$log","contextoCliente",function($q,$log,contextoCliente){var defer=$q.defer();return contextoCliente.getInfoClienteDesdeSesion().then(function(rs){defer.resolve(rs.data)},function(err){$log.error(err),defer.reject(err)}),defer.promise}]}$logProvider.debugEnabled(!0),cfpLoadingBarProvider.includeSpinner=!0,$animateProvider.classNameFilter(/animate-/),$stateProvider.state("root",{"abstract":!0,resolve:{userProfile:getUserProfile(),clienteData:getCliente()},views:{"header@":{controller:"headerInputCtrl",templateUrl:"commons/templates/header-input/header_tpl.html",controllerAs:"headermenu"},"aside@":{controller:"vm",templateUrl:"commons/templates/menu-aside/menu-aside_tpl.html",controllerAs:"asidemenu"},"main@":{},"footer@":{}}}),$urlRouterProvider.otherwise("/cuenta/variable"),$httpProvider.interceptors.push(["$q",function($q){return{request:function(httpConfig){var token=localStorage.token,url=httpConfig.url;return token&&angular.isDefined(url)&&(httpConfig.headers["X-AUTH-TOKEN"]=token),httpConfig},responseError:function(response){return $q.reject(response)}}}])}angular.module("WebBancoChile").config(myAppConfig),myAppConfig.$inject=["$stateProvider","$urlRouterProvider","$animateProvider","$httpProvider","$logProvider","cfpLoadingBarProvider"]}(),function(){function menuAsideConfig($stateProvider){$stateProvider.state("menuAside",{parent:"root",url:"/menuAside",views:{"aside@":{controller:"menuAsideCtrl",templateUrl:"menu-aside/menu-aside_tpl.html",controllerAs:"controlmenu"}},data:{pageTitle:"bancoChile"}})}angular.module("WebBancoChile.menuAside").config(menuAsideConfig)}(),function(){function cuentaConfig($stateProvider,$urlRouterProvider,TABS_POSVENTA_CUENTA){function activeTab(tab,tabs){return["tabsService",function(tabsService){return tabsService.setActiveTab(tab,tabs)}]}$stateProvider.state("cuenta",{parent:"root","abstract":!0,url:"/cuenta/:nroProducto",views:{"main@":{controller:"cuentaCtrl",templateUrl:"components/cuenta/cuenta_tpl.html",controllerAs:"cc"}},data:{pageTitle:"Cuentas"}}).state("saldo",{url:"/saldo",parent:"cuenta",resolve:{tabActive:activeTab(TABS_POSVENTA_CUENTA.SALDOS,TABS_POSVENTA_CUENTA)},views:{saldo:{controller:"SaldoController",templateUrl:"components/saldo/saldo_tpl.html",controllerAs:"sld"}}}).state("transferencias",{url:"/transferencias",parent:"cuenta",resolve:{tabActive:activeTab(TABS_POSVENTA_CUENTA.TRANSFERENCIAS,TABS_POSVENTA_CUENTA)},views:{transferencias:{controller:"TransferenciasController",templateUrl:"components/cuenta/transferencias/transferencias_tpl.html",controllerAs:"tef"}}}).state("cartolas",{url:"/cartolas",parent:"cuenta",resolve:{tabActive:activeTab(TABS_POSVENTA_CUENTA.CARTOLA_HISTORICA,TABS_POSVENTA_CUENTA)},views:{cartolas:{controller:"CartolaController",templateUrl:"components/cuenta/cartolas/cartola_tpl.html",controllerAs:"crt"}}}).state("chequeras",{url:"/chequeras",parent:"cuenta",resolve:{tabActive:activeTab(TABS_POSVENTA_CUENTA.CHEQUERAS,TABS_POSVENTA_CUENTA)},views:{chequeras:{controller:"ChequerasController",templateUrl:"components/cheques/chequeras_tpl.html",controllerAs:"chq"}}}).state("tarjetas-debito",{url:"/tarjetas-debito",parent:"cuenta",resolve:{tabActive:activeTab(TABS_POSVENTA_CUENTA.TARJETA_DEBITO,TABS_POSVENTA_CUENTA)},views:{"tarjetas-debito":{controller:"TarjetasDebitoCtrl",templateUrl:"components/cuenta/tarjetas-debito/tarjetas-debito_tpl.html",controllerAs:"tar"}}}).state("descarga-documentos",{url:"/descarga-documentos",parent:"cuenta",resolve:{tabActive:activeTab(TABS_POSVENTA_CUENTA.DOCUMENTOS,TABS_POSVENTA_CUENTA)},views:{"descarga-documentos":{controller:"DescargaDocumentosCtrl",controllerAs:"docs",templateUrl:"components/descarga-documentos/descarga-documentos_tpl.html"}}}),$urlRouterProvider.when("/cuenta/:nroProducto","/cuenta/:nroProducto/saldo").when("/cuenta/:nroProducto/chequeras","/cuenta/:nroProducto/chequeras/chequeras-activas")}angular.module("WebBancoChile.servCuenta").config(cuentaConfig)}(),function(){function homeConfig($stateProvider){$stateProvider.state("home",{parent:"root",url:"/home",views:{"main@":{controller:"homeCtrl",templateUrl:"components/home/home_tpl.html",controllerAs:"control"}},data:{pageTitle:"home"}})}angular.module("WebBancoChile.home").config(homeConfig)}(),function(){function appCtrl($scope,JWTFactory,$window,$log){$scope.open=!1,$scope.$on("$stateChangeSuccess",function(event,toState){angular.isDefined(toState.data.pageTitle)&&($scope.pageTitle=toState.data.pageTitle+" | Banco de Chile")}),$scope.openMenu=function(){$scope.open=!$scope.open,$scope.$broadcast("resizeMenuEvent",open)},JWTFactory.getToken().success(function(data){$window.localStorage.token=data.token,$log.debug("Token obtenido desde Backend: "+JSON.stringify(data))}).error(function(err,status){$window.localStorage.removeItem("token"),$log.error("Error al obtener el token.\nSTATUS: "+status+"\nERROR: "+JSON.stringify(err))})}angular.module("WebBancoChile").controller("AppCtrl",appCtrl),appCtrl.$inject=["$scope","JWTFactory","$window","$log"]}(),function(){var PERMISSIONS={};angular.module("WebBancoChile.constants",[]).constant("CONSTANTE_PRUEBA","ESTA ES UNA CONSTANTE").constant("URL_API","/miplataforma").constant("CONTEXT_CONSULTA_PRODUCTOS","/consulta-producto-cliente").constant("PERMISSIONS",PERMISSIONS)}(),function(){angular.module("WebBancoChile.constants").constant("PERMISSIONS_EM",{CONSULTAR_DS:["ROLE_EM_CONSULTA_DS_CONSULTAR"],CONSULTAR_TD:["ROLE_EM_CONSULTA_TD_CONSULTAR"],CONSULTAR_TC:["ROLE_EM_CONSULTA_TC_CONSULTAR"],APP_BLOQUEO:["ROLE_EM_APPEMPLAT_EJECUTAR"],EJECUTAR_DS:["ROLE_EM_BLOQ_DS_SUC_EJECUTAR","ROLE_EM_BLOQ_DS_BT_EJECUTAR"],EJECUTAR_TD:["ROLE_EM_BLOQ_TD_SUC_EJECUTAR","ROLE_EM_BLOQ_TD_BT_EJECUTAR"],EJECUTAR_TC:["ROLE_EM_BLOQ_TC_SUC_EJECUTAR","ROLE_EM_BLOQ_TC_BT_EJECUTAR"],CONSULTAR_BITACORA_BQ:["ROLE_EM_CONS_BIT_BQ_CONSULTAR"],CONSULTAR_BITACORA_ONP:["ROLE_EM_CONS_BIT_ONP_CONSULTAR"],CONSULTAR_ONP:["ROLE_EM_CONSULTA_ONP_CONSULTAR"],INGRESAR_ONP:["ROLE_EM_ING_ONP_BT_EJECUTAR","ROLE_EM_ING_ONP_SUC_EJECUTAR"],RATIFICAR_ONP:["ROLE_EM_RAT_ONP_SUC_EJECUTAR","ROLE_EM_RAT_ONP_BT_EJECUTAR"],REVOCAR_ONP:["ROLE_EM_REV_ONP_BT_EJECUTAR","ROLE_EM_REV_ONP_SUC_EJECUTAR"]}).constant("URL_EM_BANCARIAS",{RESUMEN_SEGURO:"/seguro-consulta/contratados/resumen"}).constant("TALLER_EM",{DISPOSITIVOS:{codigo:{DIGIPASS:8,DIGICARD:1,MIPASS:9},grupo:"DS"},TARJETAS_CREDITO:{codigo:{},grupo:"TC"},TARJETAS_DEBITO:{codigo:{},grupo:"TD"}}).constant("ESTADOS_EM_BLOQUEOS",{ACTIVO:"Activo",BLOQUEADO:"Bloqueado",VIGENTE:"Vigente"}).constant("CFG_EM",{MOTIVO_POR_DEFECTO:1,MENSAJE_TEXTO_REEMPLAZAR:"Reingrese a Emergencias Bancarias"}).constant("TABS_CFG",[{heading:"Bloqueo de productos",state:"emergencias.bloqueos",view:"bloqueos",active:!1,reload:!0,visible:!0,permisos:["CONSULTAR_DS","CONSULTAR_TD","CONSULTAR_TC"]},{heading:"ONP de Cheques",state:"emergencias.ordenNoPago",view:"onp",active:!1,reload:!0,visible:!0,permisos:["CONSULTAR_ONP","INGRESAR_ONP","RATIFICAR_ONP","REVOCAR_ONP"]},{heading:"Historial de bloqueos",state:"emergencias.historial",view:"historial",active:!1,reload:!0,visible:!0,permisos:["CONSULTAR_BITACORA_BQ"]}])}(),function(){function filterPaginator(){function filterFilter(input,listFind,searchText){return input&&searchText&&""!==searchText?"object"!=typeof listFind||0===listFind.length?input:input.filter(function(row){var show=!1;for(var variable in row)if(null!==row[variable]&&-1!==listFind.indexOf(variable)&&-1!==row[variable].toString().toLowerCase().indexOf(searchText.toString().toLowerCase())){show=!0;break}return show}):input}return filterFilter}angular.module("WebBancoChile.servCuenta").filter("filterPaginator",filterPaginator)}(),function(){function menuAsideCtrl(){var vm=this;vm.menu={items:[{name:"Inicio",auth:[],link:"#/home",id:"1",open:!1,clase:"aside-nav__category",icono:"fa fa-home",items:[]},{name:"Cartola Historica",auth:["ROLE_CAJACUPOSTARJ_CONSULTAR","ROLE_CAJANUMCTA_CONSULTAR","ROLE_CAJANUMTARJ_CONSULTAR","ROLE_MOVIMIENTOSTARJ_CONSULTAR","ROLE_CAJASALDOCTA_CONSULTAR","ROLE_CUPOFUNCIONARIO_CONSULTAR","ROL_SALDOFUNCIONARI_CONSULTAR","ROL_TARJFUNCIONARIO_CONSULTAR"],link:"",id:"2",open:!1,clase:"aside-nav__category aside-nav__category--dropdown",icono:"fa fa-users",items:[{name:"Gestión Post Venta",url:"#/depositos/postventa/listado",external:!1,auth:["ROLE_CAJACUPOSTARJ_CONSULTAR","ROLE_CAJANUMCTA_CONSULTAR","ROLE_CAJANUMTARJ_CONSULTAR","ROLE_MOVIMIENTOSTARJ_CONSULTAR","ROLE_CAJASALDOCTA_CONSULTAR","ROLE_CUPOFUNCIONARIO_CONSULTAR","ROL_SALDOFUNCIONARI_CONSULTAR","ROL_TARJFUNCIONARIO_CONSULTAR"]}]}]},vm.openMenu=function(id){angular.forEach(vm.menu.items,function(value){value.id===id?value.open?value.open=!1:value.open=!0:value.open=!1})}}angular.module("WebBancoChile.menuAside").controller("menuAsideCtrl",menuAsideCtrl)}(),function(){angular.module("WebBancoChile.servCuenta").controller("asideActivacionCuentaCtrl",["$modalInstance","cuenta","CuentaFactory","errorHandlerService",function($modalInstance,cuenta,CuentaFactory,errorHandlerService){function resetForm(){obtieneDetalleCuenta()}function cancel(){$modalInstance.dismiss("cancel")}function obtieneDetalleCuenta(){vm.error.detalle={},vm.loading.detalle=!0,CuentaFactory.getDetalleCuenta(vm.cuenta.numProducto).then(function(rs){vm.cuentaActual=rs.data,vm.loading.detalle=!1},function(err){vm.loading.detalle=!1,vm.error.detalle=errorHandlerService.gestionarError(err)})}function activarCuenta(){vm.error.activacion={},vm.pressActivar=!0,vm.formActivarCuenta.$valid&&(vm.loading.activacion=!0,CuentaFactory.activacionCuenta(vm.cuenta.numProducto,vm.cuentaActual.codigoClaseCuenta).then(function(rs){vm.pasoOne=!1,vm.pasoTwo=!0,vm.activacionRealizada=rs.data,vm.loading.activacion=!1},function(err){vm.error.activacion=errorHandlerService.gestionarError(err),vm.loading.activacion=!1}))}var vm=this;angular.extend(vm,{errorHandlerService:errorHandlerService,cancel:cancel,activarCuenta:activarCuenta,obtieneDetalleCuenta:obtieneDetalleCuenta,cuenta:cuenta,producto:"cuenta",cuentaActual:null,error:{},loading:{},pasoOne:!0,pasoTwo:!1,pressActivar:!1}),resetForm()}])}(),function(){angular.module("WebBancoChile.servCuenta").controller("asideBloqueoCuentaCtrl",["$modalInstance","cuenta",function($modalInstance,cuenta){function cancel(){$modalInstance.dismiss("cancel")}var vm=this;angular.extend(vm,{cancel:cancel,cuenta:cuenta,producto:"cuenta"})}])}(),function(){angular.module("WebBancoChile.servCuenta").controller("asideDesbloqueoCuentaCtrl",["$modalInstance","cuenta","CuentaFactory","errorHandlerService","$filter",function($modalInstance,cuenta,CuentaFactory,errorHandlerService,$filter){function init(){obtieneDetalleCuenta()}function cancel(){$modalInstance.dismiss("cancel")}function obtieneDetalleCuenta(){vm.error.cuenta={},vm.cargando.cuenta.detalle=!0,CuentaFactory.getDetalleCuenta(cuenta.numProducto).then(function(rs){vm.cuentaConsultada.numero=cuenta.numProducto,vm.cuentaConsultada.indicadorBloqueo=rs.data.indicadorBloqueo,vm.cuentaConsultada.indicadorBloqueoCliente=rs.data.indicadorBloqueoCliente,calculaEstadoCuenta(rs),vm.cargando.cuenta.detalle=!1},function(err){vm.cargando.cuenta.detalle=!1,vm.error.cuenta.detalle=errorHandlerService.gestionarError(err)})}function calculaEstadoCuenta(rs){vm.cuentaConsultada.indicadorBloqueo||vm.cuentaConsultada.indicadorBloqueoCliente?(vm.cuentaConsultada.indicadorBloqueoCliente&&(vm.cuentaConsultada.motivoBloqueo="Bloqueo Cliente",vm.cuentaConsultada.codigoMotivoBloqueo="NORM",vm.cuentaConsultada.razonBloqueo=null!==rs.data.razonBloqueo?rs.data.razonBloqueo.descripcion:""),vm.cuentaConsultada.indicadorBloqueo&&(vm.cuentaConsultada.motivoBloqueo=rs.data.subEstadoCuenta.descripcion,vm.cuentaConsultada.codigoMotivoBloqueo=rs.data.subEstadoCuenta.codigo,vm.cuentaConsultada.razonBloqueo=""),$filter("uppercase")(cuenta.estado)===$filter("uppercase")("Vigente o Activo")?vm.cuentaConsultada.estado="En proceso de bloqueo":vm.cuentaConsultada.estado=cuenta.estado,vm.cuentaConsultada.nombreComercial=rs.data.nombreComercial,vm.cuentaConsultada.productoComercial=rs.data.productoComercial,vm.cuentaConsultada.moneda=rs.data.moneda,vm.cuentaConsultada.tiposBloqueo=rs.data.tiposBloqueo):vm.cuentaConsultada.estado=cuenta.estado}function desbloquearCuenta(){vm.pressDesbloquear=!0,vm.desbloqueoForm.$valid&&(vm.cargando.cuenta.desbloqueo=!0,CuentaFactory.desbloqueoCuenta(vm.cuentaConsultada.numero,vm.cuentaConsultada.codigoMotivoBloqueo).then(function(rs){vm.pasoOne=!1,vm.pasoTwo=!0,vm.desbloqueoRealizado=rs.data,vm.cargando.cuenta.desbloqueo=!1},function(err){vm.cargando.cuenta.desbloqueo=!1,vm.error.cuenta.desbloqueo=errorHandlerService.gestionarError(err)}))}var vm=this;angular.extend(vm,{cancel:cancel,pressDesbloquear:!1,cargando:{cuenta:{}},error:{cuenta:{}},cuentaConsultada:{},obtieneDetalleCuenta:obtieneDetalleCuenta,desbloquearCuenta:desbloquearCuenta,pasoOne:!0,pasoTwo:!1}),init()}])}(),function(){function cartolaController($scope,CartolaFactory,$state){function getCartolasEmitidas(){vm.message.error="",vm.loading=!0;var filterData={cuenta:vm.numProductoFormateado,soloUltimaCartola:!1,token:cc.cuentaTemp.codigoProducto};CartolaFactory.getCartolas(filterData).then(function(data){vm.loading=!1,vm.listaCartolasEmitidas=data},function(err){vm.loading=!1,vm.message.error=err})}function descargarCartola(llave){vm.loading=!0;var filterData={numProducto:vm.numProductoFormateado,llave:llave,rut:cc.rutCliente},dateString=moment().format("YYYY-MM-DD"),rutSinDV=cc.rutCliente.substring(0,cc.rutCliente.indexOf("-"));CartolaFactory.getCartolaPDF(filterData).then(function(data){vm.loading=!1;var blob=new Blob([data],{type:"application/pdf"});saveAs(blob,"Cartola_Emitida_"+rutSinDV+"_"+dateString+".pdf")},function(err){angular.message.error=err,vm.loading=!1})}var vm=this,cc=$scope.$parent.$parent.$parent.cc;angular.extend(vm,{cuenta:{},message:{error:""},numProductoFormateado:"000000000000",loading:!0,listaCartolasEmitidas:[],descargarCartola:descargarCartola}),$scope.$watch(function(){return $scope.$parent.$parent.$parent.cc.cuentaTemp},function(newVal,oldVal){_.isEmpty(newVal)||(_.isEmpty(oldVal)||oldVal.numProducto===newVal.numProducto||$state.go("saldo"),vm.numProductoFormateado=("000000000000"+newVal.numProducto).slice(newVal.numProducto.length),getCartolasEmitidas())})}angular.module("WebBancoChile.servCuenta").controller("CartolaController",cartolaController),cartolaController.$inject=["$scope","CartolaFactory","$state"]}(),function(){function cartolaFactory($http,$q,URL_API,CuentaService){function getCartolas(filter){var deferred=$q.defer();return $http.post(URL_API+"/servicioscartola/cartolas/getCartolasEmitidas",filter).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function getCartolaPDF(filter){var deferred=$q.defer();return $http.post(URL_API+"/servicioscartola/descargas/getCartolaPDF",filter,{responseType:"arraybuffer",headers:{Accept:"application/pdf","Content-Type":"application/json"}}).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}var service={getCartolas:getCartolas,getCartolaPDF:getCartolaPDF};return service}angular.module("WebBancoChile.servCuenta").factory("CartolaFactory",cartolaFactory),cartolaFactory.$inject=["$http","$q","URL_API","CuentaService"]}(),function(){function clienteFactory($http,$log,URL_API,$q,CuentaService){function getCorreoCliente(rut){var deferred=$q.defer();return $http.get(URL_API+"/consulta-producto-cliente/datosCliente/getMailPersona",{params:{rut:rut}}).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}var service={getCorreoCliente:getCorreoCliente};return service}angular.module("WebBancoChile.servCuenta").factory("ClienteFactory",clienteFactory),clienteFactory.$inject=["$http","$log","URL_API","$q","CuentaService"]}(),function(){function clienteService(){self=this,self.formatRut=function(rut){return rut.replace(/[.]/g,"")},self.validateRut=function(rut){var _dv=rut.split("-")[1],_dvCalculated=self.calculateDv(rut.split("-")[0]);return _dvCalculated===_dv.toUpperCase()},self.calculateDv=function(rut){for(var M=0,S=1;rut;rut=Math.floor(rut/10))S=(S+rut%10*(9-M++%6))%11;return S?(S-1).toString():"K"}}angular.module("WebBancoChile.servCuenta").service("ClienteService",clienteService),clienteService.$inject=[];var self}(),function(){angular.module("WebBancoChile.servCuenta").constant("TABS_POSVENTA_CUENTA",{SALDOS:{value:1,name:"SALDOS",label:"Tab 1",ref:"saldo"},TRANSFERENCIAS:{value:2,name:"TRANSFERENCIAS",label:"Transferencias",ref:"transferencias"},CARTOLA_HISTORICA:{value:3,name:"CARTOLA_HISTORICA",label:"Cartola histórica",ref:"cartolas"},TARJETA_DEBITO:{value:4,name:"TARJETA_DEBITO",label:"Tab 2",ref:"tarjetas-debito"},CHEQUERAS:{value:5,name:"CHEQUERAS",label:"Cheques",ref:"chequeras-activas"},DOCUMENTOS:{value:6,name:"DOCUMENTOS",label:"Documentos",ref:"descarga-documentos"}})}(),function(){angular.module("WebBancoChile.servCuenta").controller("cuentaCtrl",function($scope,$stateParams,$injector,$q,$state,$filter,$modal){function activate(){vm.nroProducto=$stateParams.nroProducto,vm.currentTab=$state.current.name,vm.active[$state.current.name]=!0,obtenerDatosClienteSesion()}function obtenerDatosClienteSesion(){contextoCliente.getInfoClienteDesdeSesion().then(function(rs){vm.cliente=rs.data,vm.rutCliente=rs.data.rutCliente,vm.cuentaService.modeloCompartido.rutCliente=vm.rutCliente,vm.cuentaService.modeloCompartido.cliente=vm.cliente,$scope.$root.$broadcast("header::clienteLoaded"),findProductos()},function(err){vm.error=err})}function findProductos(){if(vm.loading=!0,vm.cliente.productos.length>0){var listaCuentas=_.filter(vm.cliente.productos,function(value){return"P"===value.tipoCliente?["JUV","CTD","CEX","YTD","YEX"].indexOf(value.codigoProducto)>-1:["JUV","CTD","CEX","YTD","YEX","XHB"].indexOf(value.codigoProducto)>-1});vm.cuentas=_.map(listaCuentas,function(value){return value.glosaDesNumProd=value.descripcion+", N° "+value.numProducto,value.numProducto===vm.nroProducto&&(vm.cuentaTemp=value,findMovimientos()),value}),vm.loading=!1}else vm.loading=!1}function findMovimientos(fechaFin,cantMovimientos){return void 0!==vm.cuentaTemp&&null!==vm.cuentaTemp?(vm.cuentaTemp.estadoUpper=$filter("uppercase")(vm.cuentaTemp.estado),$q(function(resolve,reject){vm.mensajeAlerta={severity:"",message:"",show:!1},vm.loading=!0,"chequeras"===$state.current.name?("JUV"===vm.cuentaTemp.codigoProducto||"CTD"===vm.cuentaTemp.codigoProducto&&"CVICCH"===vm.cuentaTemp.claseCuenta)&&($state.go("saldo"),vm.active.saldo=!0):"saldo"===$state.current.name&&($state.go("saldo"),vm.active.saldo=!0);var filter={};(null===cantMovimientos||void 0===cantMovimientos)&&(filter={rutCliente:vm.rutCliente,numeroProducto:vm.cuentaTemp.numProducto,tipoProducto:vm.cuentaTemp.codigoProducto,fechaBusqueda:moment(moment(fechaFin)).valueOf()},cuentaFactory.getMovimientosCuenta(filter).then(function(movimientos){return vm.cuenta=movimientos,angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuentaTemp),angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuenta),vm.loading=!1,resolve()},function(err){return vm.loading=!1,angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuentaTemp),vm.mensajeAlerta.severity="error",vm.mensajeAlerta.message="Servicio no disponible, intente más tarde.",vm.mensajeAlerta.show=!0,reject(err)})),null!==cantMovimientos&&null===fechaFin&&(filter={rutCliente:vm.rutCliente,numeroProducto:vm.cuentaTemp.numProducto,tipoProducto:vm.cuentaTemp.codigoProducto,cantidadMovimientos:cantMovimientos},cuentaFactory.getMovimientosCuentaPorCantMovimientos(filter).then(function(movimientos){return vm.cuenta=movimientos,angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuentaTemp),angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuenta),vm.loading=!1,resolve()},function(err){return vm.loading=!1,angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuentaTemp),vm.mensajeAlerta.severity="error",vm.mensajeAlerta.message="Servicio no disponible, intente más tarde.",vm.mensajeAlerta.show=!0,reject(err)}))})):($state.go("saldo"),vm.active.saldo=!0,vm.cuenta={},angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuentaTemp),angular.extend(vm.cuentaService.modeloCompartido.cuenta,vm.cuenta),vm.loading=!1,vm.mensajeAlerta.severity="error",vm.mensajeAlerta.message="Servicio no disponible, intente más tarde.",vm.mensajeAlerta.show=!0,void 0)}function openModalGestiones(size,action){var urlModal=null,modalController=null,modalControllerAs=null;switch(action){case"desblq":urlModal="components/cuenta/asides/aside-desbloqueo-cuenta_tpl.html",modalController="asideDesbloqueoCuentaCtrl",modalControllerAs="adc";break;case"blq":urlModal="components/cuenta/asides/aside-bloqueo-cuenta_tpl.html",modalController="asideBloqueoCuentaCtrl",modalControllerAs="abc";break;case"activ":urlModal="components/cuenta/asides/aside-activacion-cuenta_tpl.html",modalController="asideActivacionCuentaCtrl",modalControllerAs="act";break;case"chequeraAdicional":urlModal="components/cheques/asides/aside-solicitud-chequera-adicional_tpl.html",modalController="solicitarChequeraAdicionalCtrl",modalControllerAs="chequeraAdicional"}if(null!==size&&null!==urlModal&&null!==modalController&&null!==modalControllerAs){var modalInstance=$modal.open({templateUrl:urlModal,animation:!0,controller:modalController,controllerAs:modalControllerAs,size:size,windowClass:"modal-detalle",backdrop:!0,resolve:{cuenta:function(){return vm.cuentaService.modeloCompartido.cuenta}}});modalInstance.result.then()}}var vm=this,contextoCliente=$injector.get("contextoCliente"),cuentaFactory=$injector.get("CuentaFactory");vm.cuentaService=$injector.get("CuentaService"),vm.TABS_POSVENTA_CUENTA=$injector.get("TABS_POSVENTA_CUENTA"),angular.extend(vm,{rutCliente:null,loading:!0,cuenta:null,cuentas:[],cuentaTemp:null,active:[],mensajeAlerta:{severity:"",message:"",show:!1},findMovimientos:findMovimientos,openModalGestiones:openModalGestiones}),activate()})}(),function(){function cuentaFactory($http,$log,URL_API,$q,CuentaService){function getProductos(rut){var deferred=$q.defer();return $http.get(URL_API+"/consulta-producto-cliente/consulta/productosCliente/"+rut).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function getMovimientosCuenta(filter){var deferred=$q.defer();return $http.post(URL_API+"/servicios-movimientos-cuenta/consulta/movimientosCuenta",filter).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function getMovimientosCuentaPorCantMovimientos(filter){var deferred=$q.defer();return $http.post(URL_API+"/servicios-movimientos-cuenta/consulta/movimientos-cuenta/filtro/cantidad",filter).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function getSaldosMovimientos(filter){var deferred=$q.defer();return $http.post(URL_API+"/servicios-movimientos-cuenta/descarga/descargasCuentaCorrientePdf",filter,{responseType:"arraybuffer",headers:{Accept:"application/pdf","Content-Type":"application/json"}}).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function envioPdfSaldoMovimientos(filter){var deferred=$q.defer();return $http.post(URL_API+"/servicios-movimientos-cuenta/mail/sendMovimientosCtaCte",filter).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function getAmountRanges(moneda){var deferred=$q.defer(),rangoCLP=[{name:"Todos",minAmount:-99999999999,maxAmount:99999999999},{name:"$1 - $100.000",minAmount:1,maxAmount:1e5,origen:"NAC"},{name:"$100.001 - $1.000.000",minAmount:100001,maxAmount:1e6},{name:"$1.000.001 - $5.000.000",minAmount:1000001,maxAmount:5e6},{name:"Más de $5.000.000",minAmount:5000001,maxAmount:99999999999}],rangoUSD=[{name:"Todos",minAmount:-99999999999,maxAmount:99999999999},{name:"USD 1 - USD 1.000",minAmount:1,maxAmount:1e3,origen:"NAC"},{name:"USD 1.001 - USD 10.000",minAmount:1001,maxAmount:1e4},{name:"USD 10.001 - USD 100.000",minAmount:10001,maxAmount:1e5},{name:"Más de USD 100.000",minAmount:1e5,maxAmount:99999999999}],rangoEUR=[{name:"Todos",minAmount:-99999999999,maxAmount:99999999999},{name:"EUR 1 - EUR 1.000",minAmount:1,maxAmount:1e3,origen:"NAC"},{name:"EUR 1.001 - EUR 10.000",minAmount:1001,maxAmount:1e4},{name:"EUR 10.001 - EUR 100.000",minAmount:10001,maxAmount:1e5},{name:"Más de EUR 100.000",minAmount:1e5,maxAmount:99999999999}];return"USD"===moneda?deferred.resolve(rangoUSD):"EUR"===moneda?deferred.resolve(rangoEUR):deferred.resolve(rangoCLP),deferred.promise}function getDetalleCuenta(numeroProducto){var URL=URL_API+"/servicios-movimientos-cuenta/consulta/cuenta/detalle/"+numeroProducto;return $http.get(URL)}function desbloqueoCuenta(numeroProducto,nuevoEstado){var url=URL_API+"/servicios-cuenta-linea/cuenta/desbloqueo",data={nroProducto:numeroProducto,nuevoEstadoCuenta:nuevoEstado};return $http.post(url,data)}function activacionCuenta(numeroProducto,clase){var url=URL_API+"/servicios-cuenta-linea/cuenta/activacion",data={cuenta:numeroProducto,clase:clase};return $http.post(url,data)}var factory={getProductos:getProductos,getMovimientosCuenta:getMovimientosCuenta,getMovimientosCuentaPorCantMovimientos:getMovimientosCuentaPorCantMovimientos,getSaldosMovimientos:getSaldosMovimientos,envioPdfSaldoMovimientos:envioPdfSaldoMovimientos,getAmountRanges:getAmountRanges,getDetalleCuenta:getDetalleCuenta,desbloqueoCuenta:desbloqueoCuenta,activacionCuenta:activacionCuenta};return factory}angular.module("WebBancoChile.servCuenta").factory("CuentaFactory",cuentaFactory),cuentaFactory.$inject=["$http","$log","URL_API","$q","CuentaService"]}(),function(){function cuentaService(){function errorHandler(err){var message={message:"Servicio no disponible, reintente mas tarde.",type:"error"};return _.isObject(err)&&(_.isEmpty(err.catalogMessage)||(message.message=err.catalogMessage),_.isEmpty(err.exceptionMessage)||(message.message=err.exceptionMessage),err.errorSeverity&&("info"===err.errorSeverity.toLowerCase()?message.type="information":message.type=err.errorSeverity.toLowerCase()),"100000"===err.errorCode&&(message.type="information")),message}this.errorHandler=errorHandler,this.modeloCompartido={rutCliente:null,cuenta:{},cliente:{}}}angular.module("WebBancoChile.servCuenta").service("CuentaService",cuentaService),cuentaService.$inject=[]}(),function(){function tabsService(){}angular.module("WebBancoChile.servCuenta").service("tabsService",tabsService),tabsService.$inject=[],tabsService.prototype.setActiveTab=function(tab,tabs){var vm=this;return vm.desativeAllTabs(tabs),tab.active=!0,tab},tabsService.prototype.desativeAllTabs=function(tabs){var keys=Object.keys(tabs);angular.forEach(keys,function(value){tabs[value].active=!1})}}(),function(){function activarTarjetaDebitoCtrl($scope,data,$modalInstance,TarjetasDebitoFactory){self=this,self.scope=$scope,self.tarjetaDebito=data.tarjetaDebito,self.listaCorreos=data.listaCorreos?data.listaCorreos:[],self.numeroCuenta=data.numeroCuenta,self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.modalInstance=$modalInstance,self.estado=1,self.isCheckConfirm=!1,self.isMailSended=!1,self.isMailErrorSended=!1,self.isActivarFailed=!1,self.correoSelected=self.listaCorreos[0]?self.listaCorreos[0]:"",self.correoMsjExito="",self.listaEstados={1:"Inicial",2:"Resumen",3:"Final"}}angular.module("WebBancoChile.servCuenta").controller("activarTarjetaDebitoCtrl",activarTarjetaDebitoCtrl);var self;activarTarjetaDebitoCtrl.$inject=["$scope","data","$modalInstance","TarjetasDebitoFactory"],activarTarjetaDebitoCtrl.prototype.activarTarjeta=function(){var _body={numeroDeTarjeta:self.tarjetaDebito.numeroTarjeta,isRedbank:self.tarjetaDebito.codigoRedBanc,isRedcompra:self.tarjetaDebito.codigoRedCompra,restriccion:self.tarjetaDebito.restriccion,servicios:self.tarjetaDebito.servicios};self.tarjetasDebitoFactory.activarTarjeta(_body).success(function(){self.nextState(),self.scope.$emit("getTarjetasDebito")}).error(function(){self.isActivarFailed=!0})},activarTarjetaDebitoCtrl.prototype.descargaPDF=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.getPDFActivar(_body).then(function(response){var _blob=new Blob([response.data],{type:"application/pdf"});saveAs(_blob,"Activar_"+self.tarjetaDebito.numeroTarjeta+".pdf"),self.isActivarFailed=!1},function(){self.isActivarFailed=!0})},activarTarjetaDebitoCtrl.prototype.sendMail=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.sendMailActivar(self.correoSelected,_body).success(function(){self.isMailSended=!0,self.isMailErrorSended=!1,self.correoMsjExito=angular.copy(self.correoSelected)}).error(function(){self.isMailSended=!1,self.isMailErrorSended=!0})},activarTarjetaDebitoCtrl.prototype.ok=function(){self.modalInstance.close()},activarTarjetaDebitoCtrl.prototype.cancel=function(){self.modalInstance.dismiss("cancel")},activarTarjetaDebitoCtrl.prototype.nextState=function(){self.estado++},activarTarjetaDebitoCtrl.prototype.backState=function(){self.estado--}}(),function(){function anularTarjetaDebitoCtrl($scope,data,$modalInstance,TarjetasDebitoFactory){self=this,self.scope=$scope,self.tarjetaDebito=data.tarjetaDebito,self.listaCorreos=data.listaCorreos?data.listaCorreos:[],self.numeroCuenta=data.numeroCuenta,
self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.modalInstance=$modalInstance,self.estado=1,self.isCheckConfirm=!1,self.isMailSended=!1,self.isMailErrorSended=!1,self.isAnularFailed=!1,self.correoSelected=self.listaCorreos[0]?self.listaCorreos[0]:"",self.correoMsjExito="",self.listaEstados={1:"Inicial",2:"Resumen",3:"Final"}}angular.module("WebBancoChile.servCuenta").controller("anularTarjetaDebitoCtrl",anularTarjetaDebitoCtrl);var self;anularTarjetaDebitoCtrl.$inject=["$scope","data","$modalInstance","TarjetasDebitoFactory"],anularTarjetaDebitoCtrl.prototype.anularTarjeta=function(){var _body={numeroDeTarjeta:self.tarjetaDebito.numeroTarjeta,isRedbank:self.tarjetaDebito.codigoRedBanc,isRedcompra:self.tarjetaDebito.codigoRedCompra,restriccion:self.tarjetaDebito.restriccion,servicios:self.tarjetaDebito.servicios};self.tarjetasDebitoFactory.anularTarjeta(_body).success(function(){self.nextState(),self.scope.$emit("getTarjetasDebito")}).error(function(){self.isAnularFailed=!0})},anularTarjetaDebitoCtrl.prototype.sendMail=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.sendMailAnular(self.correoSelected,_body).success(function(){self.isMailSended=!0,self.isMailErrorSended=!1,self.correoMsjExito=angular.copy(self.correoSelected)}).error(function(){self.isMailSended=!1,self.isMailErrorSended=!0})},anularTarjetaDebitoCtrl.prototype.descargaPDF=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.getPDFAnular(_body).then(function(response){var _blob=new Blob([response.data],{type:"application/pdf"});saveAs(_blob,"Anular"+self.tarjetaDebito.numeroTarjeta+".pdf"),self.isAnularFailed=!1},function(){self.isAnularFailed=!0})},anularTarjetaDebitoCtrl.prototype.ok=function(){self.modalInstance.close()},anularTarjetaDebitoCtrl.prototype.cancel=function(){self.modalInstance.dismiss("cancel")},anularTarjetaDebitoCtrl.prototype.nextState=function(){self.estado++},anularTarjetaDebitoCtrl.prototype.backState=function(){self.estado--}}(),function(){function cerrarTarjetaDebitoCtrl($scope,data,$modalInstance,TarjetasDebitoFactory){self=this,self.scope=$scope,self.tarjetaDebito=data.tarjetaDebito,self.listaCorreos=data.listaCorreos?data.listaCorreos:[],self.numeroCuenta=data.numeroCuenta,self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.modalInstance=$modalInstance,self.estado=1,self.isCheckConfirm=!1,self.isMailSended=!1,self.isMailErrorSended=!1,self.isCerrarFailed=!1,self.correoSelected=self.listaCorreos[0]?self.listaCorreos[0]:"",self.correoMsjExito="",self.listaEstados={1:"Inicial",2:"Final"},self.formularioValido=!0}angular.module("WebBancoChile.servCuenta").controller("cerrarTarjetaDebitoCtrl",cerrarTarjetaDebitoCtrl);var self;cerrarTarjetaDebitoCtrl.$inject=["$scope","data","$modalInstance","TarjetasDebitoFactory"],cerrarTarjetaDebitoCtrl.prototype.cerrarTarjeta=function(){var _body={numeroDeTarjeta:self.tarjetaDebito.numeroTarjeta,isRedbank:self.tarjetaDebito.codigoRedBanc,isRedcompra:self.tarjetaDebito.codigoRedCompra,restriccion:self.tarjetaDebito.restriccion,servicios:self.tarjetaDebito.servicios};self.isCheckConfirm?(self.formularioValido=!0,self.tarjetasDebitoFactory.cerrarTarjeta(_body).success(function(){self.nextState(),self.scope.$emit("getTarjetasDebito")}).error(function(){self.isCerrarFailed=!0})):self.formularioValido=!1},cerrarTarjetaDebitoCtrl.prototype.sendMail=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.sendMailCerrar(self.correoSelected,_body).success(function(){self.isMailSended=!0,self.isMailErrorSended=!1,self.correoMsjExito=angular.copy(self.correoSelected)}).error(function(){self.isMailSended=!1,self.isMailErrorSended=!0})},cerrarTarjetaDebitoCtrl.prototype.descargaPDF=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.getPDFCerrar(_body).then(function(response){var _blob=new Blob([response.data],{type:"application/pdf"});saveAs(_blob,"Cerrar"+self.tarjetaDebito.numeroTarjeta+".pdf"),self.isCerrarFailed=!1},function(){self.isCerrarFailed=!0})},cerrarTarjetaDebitoCtrl.prototype.ok=function(){self.modalInstance.close()},cerrarTarjetaDebitoCtrl.prototype.cancel=function(){self.modalInstance.dismiss("cancel")},cerrarTarjetaDebitoCtrl.prototype.nextState=function(){self.estado++},cerrarTarjetaDebitoCtrl.prototype.backState=function(){self.estado--},cerrarTarjetaDebitoCtrl.prototype.alertaCierre=function(){"Final"===self.listaEstados[self.estado]?self.modalInstance.close():swal({title:"Perderá trabajo en curso",text:"¿Está seguro que desea abandonar Cierre de Tarjeta?",type:"warning",customClass:"sweet-modales",showCancelButton:!0,animation:"slide-from-top",confirmButtonColor:"#002058",confirmButtonText:"Abandonar",cancelButtonText:"Volver",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&(self.modalInstance.close(),self.scope.$apply())})}}(),function(){function crearTarjetaDebitoCtrl($scope,data,$modalInstance,TarjetasDebitoFactory,infoClienteService,ClienteService,PerfilUsuarioService){self=this,self.graficaDescripcion="",self.graficaTarjeta="",self.tipoTarjeta="",self.inputRut="",self.isValidRut=!1,self.cliente=null,self.errorCliente=!1,self.errorFormulario=!1,self.invalido={rut:!1,rutVacio:!1,cliente:!1,sucursal:!1,check:!1},self.sucursalDefault=null,self.codigoEjecutivo=null,self.clienteService=ClienteService,self.infoClienteFactory=infoClienteService.infoClienteFactory,self.perfilUsuarioService=PerfilUsuarioService,self.scope=$scope,self.tarjetaDebito=data.tarjetaDebito,self.listaCorreos=data.listaCorreos?data.listaCorreos:[],self.numeroCuenta=data.numeroCuenta,self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.modalInstance=$modalInstance,self.estado=1,self.isCheckConfirm=!1,self.isMailSended=!1,self.isMailErrorSended=!1,self.isCrearFailed=!1,self.correoSelected=self.listaCorreos[0]?self.listaCorreos[0]:"",self.correoMsjExito="",self.listaEstados={1:"Inicial",2:"Final"},self.getOficinaEjecutivo(),self.getGrafica()}angular.module("WebBancoChile.servCuenta").controller("crearTarjetaDebitoCtrl",crearTarjetaDebitoCtrl);var self;crearTarjetaDebitoCtrl.$inject=["$scope","data","$modalInstance","TarjetasDebitoFactory","infoClienteService","ClienteService","PerfilUsuarioService"],crearTarjetaDebitoCtrl.prototype.getGrafica=function(){var _numeroTarjeta=self.tarjetaDebito.numeroTarjeta,_grafica=self.tarjetaDebito.grafica;self.tarjetasDebitoFactory.getGrafica(_numeroTarjeta,_grafica).success(function(data){self.graficaDescripcion=data.descripcionTipoTarjeta,self.graficaTarjeta=data.graficaTarjeta,self.tipoTarjeta=data.tipoTarjeta}).error(function(){self.isCrearFailed=!0})},crearTarjetaDebitoCtrl.prototype.crearTarjeta=function(){if(self.formularioValido()){self.errorFormulario=!1;var _body={accionActual:"",accionAnterior:"",bin:"",claseATM:self.tarjetaDebito.codigoRedBanc,clasePOS:self.tarjetaDebito.codigoRedCompra,codControlAct:"",codigoControlAnterior:"",codigoEstadoAnterior:"",codigoOrdenActivacion:"",codigoOrdenAnterior:"",codigoSolicitudAnterior:"",codigoUbicacionActual:"",codigoUbicacionAnterior:"",cuentasRelacionada:self.tarjetaDebito.cuentasRelacionadas.slice(0,3),detalleReemisionDomain:{apeMaternoPropietario:self.cliente.apellidoMaterno,apePaternoPropietario:self.cliente.apellidoPaterno,bancaPropietario:self.cliente.codigoBanca,codEjecutivoOrigen:self.cliente.codigoEjecutivo,codOficinaDestino:self.sucursal.codigoSucursal,codOficinaOrigen:self.tarjetaDebito.codOficinaOrigen,nombrePropietario:self.cliente.nombre,segmentoPropietario:self.cliente.codigoSegmento,sistemaOrigen:""},digitoVerificadorPropietario:"",digitoVerificadorTitular:"",ejecutivoControlActivacion:"",ejecutivoControlAnterior:"",ejecutivoOrdenActivacion:"",ejecutivoOrdenAnterior:"",ejecutivoSolicitud:self.codigoEjecutivo,ejecutivoSolicitudActivacion:"",ejecutivoSolicitudAnterior:"",estadoActual:"",fechaConfirmacion:"",fechaControlActivacion:"",fechaControlAnterior:"",fechaEstadoActual:"",fechaEstadoAnterior:"",fechaOrdenActivacion:"",fechaOrdenAnterior:"",fechaSolicitud:"",fechaSolicitudActivacion:"",fechaSolicitudAnterior:"",fechaUbicacionActual:"",fechaUbicacionAnterior:"",fechaVis:"",grafica:self.graficaTarjeta,isRecompra:"",isRedbanc:"",isTCR:"",listaGestiones:[""],nombreDelPropietario:"",numeroDeTarjeta:self.tarjetaDebito.numeroTarjeta,numeroProducto:self.numeroCuenta,oficinaControlActivacion:"",oficinaControlAnterior:"",oficinaOrdenActivacion:"",oficinaOrdenAnterior:"",oficinaSolicitud:self.sucursalDefault,oficinaSolicitudActivacion:"",oficinaSolicitudAnterior:"",restriccion:self.tarjetaDebito.restriccion,rutPropietario:self.cliente.rutCliente,rutTitular:"",servicios:self.tarjetaDebito.servicios,sistemaControlActivacion:"",sistemaControlAnterior:"",sistemaOrdenActivacon:"",sistemaOrdenAnterior:"",sistemaSolicitud:"",sistemaSolicitudActivacion:"",sistemaSolicitudAnterior:"",solicitudActivacion:"",tipoDeProducto:"",tipoPropietario:"",tipoTarjeta:self.tipoTarjeta,totalCuentasRelacionadas:""};self.tarjetasDebitoFactory.crearAdicionalTarjeta(_body).success(function(){self.nextState(),self.scope.$emit("getTarjetasDebito")}).error(function(){self.isCrearFailed=!0})}else self.errorFormulario=!0},crearTarjetaDebitoCtrl.prototype.formularioValido=function(){var _isValid=!0;return self.inputRut?(self.invalido.rutVacio=!1,self.clienteService.validateRut(self.inputRut)?self.invalido.rut=!1:(_isValid=!1,self.invalido.rut=!0,self.invalido.cliente=!1)):(_isValid=!1,self.invalido.rutVacio=!0,self.invalido.cliente=!1),self.errorCliente?(_isValid=!1,self.invalido.cliente=!0,self.invalido.rut=!1):self.invalido.cliente=!1,self.sucursal?self.invalido.sucursal=!1:(_isValid=!1,self.invalido.sucursal=!0),self.isCheckConfirm?self.invalido.check=!1:(_isValid=!1,self.invalido.check=!0),_isValid},crearTarjetaDebitoCtrl.prototype.sendMail=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.sendMailCrear(self.correoSelected,_body).success(function(){self.isMailSended=!0,self.isMailErrorSended=!1,self.correoMsjExito=angular.copy(self.correoSelected)}).error(function(){self.isMailSended=!1,self.isMailErrorSended=!0})},crearTarjetaDebitoCtrl.prototype.descargaPDF=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.getPDFCrear(_body).then(function(response){var _blob=new Blob([response.data],{type:"application/pdf"});saveAs(_blob,"Crear"+self.tarjetaDebito.numeroTarjeta+".pdf"),self.isCrearFailed=!1},function(){self.isCrearFailed=!0})},crearTarjetaDebitoCtrl.prototype.close=function(){"Final"===self.listaEstados[self.estado]?self.modalInstance.close():swal({title:"Perderá trabajo en curso",text:"¿Está seguro que desea abandonar Crear adicional?",type:"warning",customClass:"sweet-modales",showCancelButton:!0,animation:"slide-from-top",confirmButtonColor:"#002058",confirmButtonText:"Abandonar",cancelButtonText:"Volver",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&(self.modalInstance.close(),self.scope.$apply())})},crearTarjetaDebitoCtrl.prototype.nextState=function(){self.estado++},crearTarjetaDebitoCtrl.prototype.backState=function(){self.estado--},crearTarjetaDebitoCtrl.prototype.buscarCliente=function(){if(self.inputRut){var _rut=self.clienteService.formatRut(self.inputRut);self.isValidRut=self.clienteService.validateRut(_rut),self.isValidRut?(self.obtenerInfoCliente(_rut),self.invalido.rut=!1,self.invalido.cliente=!1):(self.cliente=null,self.invalido.rut=!0,self.invalido.cliente=!1)}},crearTarjetaDebitoCtrl.prototype.obtenerInfoCliente=function(rut){self.infoClienteFactory.getInfoClienteFull(rut).then(function(cliente){self.cliente=cliente.data,self.errorCliente=!1,self.clienteSinMarca()},function(){self.cliente=null,self.errorCliente=!0})},crearTarjetaDebitoCtrl.prototype.clienteSinMarca=function(){self.cliente.codigoMarca?self.cliente.tieneMarca=!0:self.cliente.tieneMarca=!1},crearTarjetaDebitoCtrl.prototype.getOficinaEjecutivo=function(){self.perfilUsuarioService.getUserProfile().then(function(ejecutivo){self.sucursalDefault=ejecutivo.codigoOficina,self.codigoEjecutivo=ejecutivo.codigo})},crearTarjetaDebitoCtrl.prototype.getNumeroTarjetaFormated=function(){for(var numDigits=4,re=new RegExp("\\w{1,"+numDigits+"}","g"),numberGroup=self.tarjetaDebito.numeroTarjeta.toString().match(re),number="",i=0;i<numberGroup.length;i++)number+=numberGroup[i]+" ";return number.trim()}}(),function(){function reemitirTarjetaDebitoCtrl($scope,data,$modalInstance,TarjetasDebitoFactory,infoClienteService,PerfilUsuarioService){self=this,self.tipoTarjeta="",self.errorFormulario=!1,self.invalido={sucursal:!1,check:!1,motivo:!1},self.cliente=null,self.sucursalDefault=null,self.motivoReemision=null,self.perfilUsuarioService=PerfilUsuarioService,self.scope=$scope,self.tarjetaDebito=data.tarjetaDebito,self.listaCorreos=data.listaCorreos?data.listaCorreos:[],self.numeroCuenta=data.numeroCuenta,self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.infoClienteFactory=infoClienteService.infoClienteFactory,self.modalInstance=$modalInstance,self.estado=1,self.isCheckConfirm=!1,self.isMailSended=!1,self.isMailErrorSended=!1,self.isReemitirFailed=!1,self.correoSelected=self.listaCorreos[0]?self.listaCorreos[0]:"",self.correoMsjExito="",self.listaEstados={1:"Inicial",2:"Final"},self.listaMotivosReemision=[{nombre:"Robo"},{nombre:"Hurto"},{nombre:"Extravío"},{nombre:"Deterioro"}],self.graficaDescripcion="",self.graficaTarjeta="",self.getOficinaEjecutivo(),self.getGrafica(),self.obtenerInfoCliente()}angular.module("WebBancoChile.servCuenta").controller("reemitirTarjetaDebitoCtrl",reemitirTarjetaDebitoCtrl);var self;reemitirTarjetaDebitoCtrl.$inject=["$scope","data","$modalInstance","TarjetasDebitoFactory","infoClienteService","PerfilUsuarioService"],reemitirTarjetaDebitoCtrl.prototype.getGrafica=function(){var _numeroTarjeta=self.tarjetaDebito.numeroTarjeta,_grafica=self.tarjetaDebito.grafica;self.tarjetasDebitoFactory.getGrafica(_numeroTarjeta,_grafica).success(function(data){self.graficaDescripcion=data.descripcionTipoTarjeta,self.graficaTarjeta=data.graficaTarjeta,self.tipoTarjeta=data.tipoTarjeta}).error(function(){self.isReemitirFailed=!0})},reemitirTarjetaDebitoCtrl.prototype.reemitirTarjeta=function(){if(self.formularioValido()){self.errorFormulario=!1;var tipoPropietario="";tipoPropietario="Titular"===self.tarjetaDebito.isTitularTarjeta?"T":"A";var _body={accionActual:"",accionAnterior:"",bin:"",claseATM:self.tarjetaDebito.codigoRedBanc,clasePOS:self.tarjetaDebito.codigoRedCompra,codControlAct:"",codigoControlAnterior:"",codigoEstadoAnterior:"",codigoOrdenActivacion:"",codigoOrdenAnterior:"",codigoSolicitudAnterior:"",codigoUbicacionActual:"",codigoUbicacionAnterior:"",cuentasRelacionada:self.tarjetaDebito.cuentasRelacionadas.slice(0,3),detalleReemisionDomain:{apeMaternoPropietario:self.cliente.apellidoMaterno,apePaternoPropietario:self.cliente.apellidoPaterno,bancaPropietario:self.cliente.codigoBanca,codEjecutivoOrigen:self.cliente.codigoEjecutivo,codOficinaDestino:self.sucursal.codigoSucursal,codOficinaOrigen:self.tarjetaDebito.codOficinaOrigen,nombrePropietario:self.cliente.nombre,segmentoPropietario:self.cliente.codigoSegmento,sistemaOrigen:""},digitoVerificadorPropietario:"",digitoVerificadorTitular:"",ejecutivoControlActivacion:"",ejecutivoControlAnterior:"",ejecutivoOrdenActivacion:"",ejecutivoOrdenAnterior:"",ejecutivoSolicitud:self.codigoEjecutivo,ejecutivoSolicitudActivacion:"",ejecutivoSolicitudAnterior:"",estadoActual:"",fechaConfirmacion:"",fechaControlActivacion:"",fechaControlAnterior:"",fechaEstadoActual:"",fechaEstadoAnterior:"",fechaOrdenActivacion:"",fechaOrdenAnterior:"",fechaSolicitud:"",fechaSolicitudActivacion:"",fechaSolicitudAnterior:"",fechaUbicacionActual:"",fechaUbicacionAnterior:"",fechaVis:"",grafica:self.graficaTarjeta,isRecompra:"",isRedbanc:"",isTCR:"",listaGestiones:[""],nombreDelPropietario:"",numeroDeTarjeta:self.tarjetaDebito.numeroTarjeta,numeroProducto:self.numeroCuenta,oficinaControlActivacion:"",oficinaControlAnterior:"",oficinaOrdenActivacion:"",oficinaOrdenAnterior:"",oficinaSolicitud:self.sucursalDefault,oficinaSolicitudActivacion:"",oficinaSolicitudAnterior:"",restriccion:self.tarjetaDebito.restriccion,rutPropietario:self.cliente.rutCliente,rutTitular:"",servicios:self.tarjetaDebito.servicios,sistemaControlActivacion:"",sistemaControlAnterior:"",sistemaOrdenActivacon:"",sistemaOrdenAnterior:"",sistemaSolicitud:"",sistemaSolicitudActivacion:"",sistemaSolicitudAnterior:"",solicitudActivacion:"",tipoDeProducto:"",tipoPropietario:tipoPropietario,totalCuentasRelacionadas:"",tipoTarjeta:self.tipoTarjeta};self.tarjetasDebitoFactory.reemitirTarjeta(_body).success(function(){self.nextState(),self.scope.$emit("getTarjetasDebito")}).error(function(){self.isReemitirFailed=!0})}else self.errorFormulario=!0},reemitirTarjetaDebitoCtrl.prototype.formularioValido=function(){var _isValid=!0;return self.sucursal?self.invalido.sucursal=!1:(_isValid=!1,self.invalido.sucursal=!0),self.motivoReemision?self.invalido.motivoReemision=!1:(_isValid=!1,self.invalido.motivoReemision=!0),self.isCheckConfirm?self.invalido.check=!1:(_isValid=!1,self.invalido.check=!0),_isValid},reemitirTarjetaDebitoCtrl.prototype.sendMail=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.sendMailReemitir(self.correoSelected,_body).success(function(){self.isMailSended=!0,self.isMailErrorSended=!1,self.correoMsjExito=angular.copy(self.correoSelected)}).error(function(){self.isMailSended=!1,self.isMailErrorSended=!0})},reemitirTarjetaDebitoCtrl.prototype.descargaPDF=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.getPDFReemitir(_body).then(function(response){var _blob=new Blob([response.data],{type:"application/pdf"});saveAs(_blob,"Reemitir"+self.tarjetaDebito.numeroTarjeta+".pdf"),self.isReemitirFailed=!1},function(){self.isReemitirFailed=!0})},reemitirTarjetaDebitoCtrl.prototype.close=function(){"Final"===self.listaEstados[self.estado]?self.modalInstance.close():swal({title:"Perderá trabajo en curso",text:"¿Está seguro que desea abandonar Reemisión de Tarjeta?",type:"warning",customClass:"sweet-modales",showCancelButton:!0,animation:"slide-from-top",confirmButtonColor:"#002058",confirmButtonText:"Abandonar",cancelButtonText:"Volver",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&(self.modalInstance.close(),self.scope.$apply())})},reemitirTarjetaDebitoCtrl.prototype.nextState=function(){self.estado++},reemitirTarjetaDebitoCtrl.prototype.backState=function(){self.estado--},reemitirTarjetaDebitoCtrl.prototype.getOficinaEjecutivo=function(){self.perfilUsuarioService.getUserProfile().then(function(ejecutivo){self.sucursalDefault=ejecutivo.codigoOficina})},reemitirTarjetaDebitoCtrl.prototype.obtenerInfoCliente=function(){var rutNumerico=parseInt(self.tarjetaDebito.rut,10),rutConcat=rutNumerico.toString()+"-"+self.tarjetaDebito.digitoVerificador;self.infoClienteFactory.getInfoClienteFull(rutConcat.trim()).then(function(cliente){self.cliente=cliente.data,self.isReemitirFailed=!1},function(){self.cliente=null,self.isReemitirFailed=!0})},reemitirTarjetaDebitoCtrl.prototype.separarNumerosTarjeta=function(){for(var numDigits=4,re=new RegExp("\\w{1,"+numDigits+"}","g"),numberGroup=self.tarjetaDebito.numeroTarjeta.toString().match(re),number="",i=0;i<numberGroup.length;i++)number+=numberGroup[i]+" ";return number.trim()}}(),function(){function resetearTarjetaDebitoCtrl($scope,data,$modalInstance,TarjetasDebitoFactory){self=this,self.scope=$scope,self.tarjetaDebito=data.tarjetaDebito,self.listaCorreos=data.listaCorreos?data.listaCorreos:[],self.numeroCuenta=data.numeroCuenta,self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.modalInstance=$modalInstance,self.estado=1,self.isCheckConfirm=!1,self.isMailSended=!1,self.isMailErrorSended=!1,self.isResetearFailed=!1,self.correoSelected=self.listaCorreos[0]?self.listaCorreos[0]:"",self.correoMsjExito="",self.listaEstados={1:"Inicial",2:"Resumen",3:"Final"}}angular.module("WebBancoChile.servCuenta").controller("resetearTarjetaDebitoCtrl",resetearTarjetaDebitoCtrl);var self;resetearTarjetaDebitoCtrl.$inject=["$scope","data","$modalInstance","TarjetasDebitoFactory"],resetearTarjetaDebitoCtrl.prototype.resetearTarjeta=function(){var _body={numeroDeTarjeta:self.tarjetaDebito.numeroTarjeta,isRedbank:self.tarjetaDebito.codigoRedBanc,isRedcompra:self.tarjetaDebito.codigoRedCompra,restriccion:self.tarjetaDebito.restriccion,servicios:self.tarjetaDebito.servicios};self.tarjetasDebitoFactory.resetearTarjeta(_body).success(function(){self.nextState(),self.scope.$emit("getTarjetasDebito")}).error(function(){self.isResetearFailed=!0})},resetearTarjetaDebitoCtrl.prototype.sendMail=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.sendMailResetear(self.correoSelected,_body).success(function(){self.isMailSended=!0,self.isMailErrorSended=!1,self.correoMsjExito=angular.copy(self.correoSelected)}).error(function(){self.isMailSended=!1,self.isMailErrorSended=!0})},resetearTarjetaDebitoCtrl.prototype.descargaPDF=function(){var _body=angular.copy(self.tarjetaDebito);_body.numeroCuenta=self.numeroCuenta,self.tarjetasDebitoFactory.getPDFResetear(_body).then(function(response){var _blob=new Blob([response.data],{type:"application/pdf"});saveAs(_blob,"Resetear"+self.tarjetaDebito.numeroTarjeta+".pdf"),self.isResetearFailed=!1},function(){self.isResetearFailed=!0})},resetearTarjetaDebitoCtrl.prototype.ok=function(){self.modalInstance.close()},resetearTarjetaDebitoCtrl.prototype.cancel=function(){self.modalInstance.dismiss("cancel")},resetearTarjetaDebitoCtrl.prototype.nextState=function(){self.estado++},resetearTarjetaDebitoCtrl.prototype.backState=function(){self.estado--}}(),function(){function TarjetasDebitoCtrl($scope,$uibModal,TarjetasDebitoFactory,contextoCliente,PerfilUsuarioService){self=this,self.claseCuenta="",self.numeroCuenta={},self.tarjetasDebito={},self.tarjetasDebito.lista=[],self.permisosEjecutivo=[],self.status={isOpen:!1},self.isErrorListar=!1,self.isLoading=!0,self.listaCorreos=[],self.contextoCliente=contextoCliente,self.tarjetasDebitoFactory=TarjetasDebitoFactory,self.perfilUsuarioService=PerfilUsuarioService,self.obtenerDatosClienteSesion(),self.obtenerPermisosEjecutivo(),$scope.$watch(function(){return $scope.$parent.$parent.$parent.cc.cuentaTemp},function(newVal){_.isEmpty(newVal)||(self.numeroCuenta=newVal.numProducto,self.claseCuenta=newVal.claseCuenta,self.getTarjetasDebito())}),$scope.$on("getTarjetasDebito",function(){self.getTarjetasDebito()}),self.openAside=function(gestion,tarjetaDebito){$uibModal.open({templateUrl:"components/cuenta/tarjetas-debito/asides/aside-"+gestion+"-tarjeta_tpl.html",animation:!0,scope:$scope,controller:gestion+"TarjetaDebitoCtrl",controllerAs:gestion,size:"xs",windowClass:"modal-detalle",backdrop:"static",resolve:{data:function(){return{tarjetaDebito:tarjetaDebito,listaCorreos:self.listaCorreos,numeroCuenta:self.numeroCuenta}}}})},self.listaGestiones={activar:{descripcion:"Activación tarjeta",permisos:["ROLE_PVTTARJDEBIT_ACTIVAR"]},anular:{descripcion:"Anulación tarjeta",permisos:["ROLE_PVTTARJDEBIT_ANULAR"]},cerrar:{descripcion:"Cierre tarjeta",permisos:["ROLE_PVTTARJDEBIT_CIERRE"]},crear:{descripcion:"Crear adicional",permisos:["ROLE_PVTTARJDEBIT_CREAR","ROLE_PVTTARJDEBITADI_CREAR"]},reemitir:{descripcion:"Remisión tarjeta",permisos:["ROLE_PVTTARJDEBIT_REEMISION"]},resetear:{descripcion:"Solicitud reseteo Nº secreto",permisos:["ROLE_PVTRESETPINTDD_RESET"]}}}angular.module("WebBancoChile.servCuenta").controller("TarjetasDebitoCtrl",TarjetasDebitoCtrl);var self;TarjetasDebitoCtrl.$inject=["$scope","$uibModal","TarjetasDebitoFactory","contextoCliente","PerfilUsuarioService"],TarjetasDebitoCtrl.prototype.getTarjetasDebito=function(){self.tarjetasDebitoFactory.getTarjetasDebito(self.numeroCuenta).success(function(data){self.tarjetasDebito.set(self.filtraGestiones(data.lista)),self.isErrorListar=!1,self.isLoading=!1}).error(function(){self.isErrorListar=!0,self.isLoading=!1})},TarjetasDebitoCtrl.prototype.filtraGestiones=function(tarjetasDebito){var _tarjetasDebito=tarjetasDebito;return"CCNMN1"!==self.claseCuenta&&(_tarjetasDebito=_.map(_tarjetasDebito,function(tarjetaDebito){return tarjetaDebito.listaGestiones=_.without(tarjetaDebito.listaGestiones,"crear"),tarjetaDebito})),_tarjetasDebito},TarjetasDebitoCtrl.prototype.validaExistenciaCuentasRelacionadas=function(cuentasRelacionadas){var _isValid=!1;return angular.forEach(cuentasRelacionadas,function(cuentaRelacionada){self.validaCuentaRelacionada(cuentaRelacionada.numeroCuenta)&&(_isValid=!0)}),_isValid},TarjetasDebitoCtrl.prototype.getDay=function(date){var _conversion=new Date(date),_days=["DOM ","LUN ","MAR ","MIÉ ","JUE ","VIE ","SÁB "];return _days[_conversion.getDay()]},TarjetasDebitoCtrl.prototype.formatBoolean=function(str){return parseInt(str,10)?"Sí":"No"},TarjetasDebitoCtrl.prototype.getColorState=function(state){switch(state.trim()){case"Vigente - Activa":return"green";case"Creada no activa":return"warning";case"Anulada":return"red";default:return"grey"}},TarjetasDebitoCtrl.prototype.validaCuentaRelacionada=function(cuentaRelacionada){return parseInt(cuentaRelacionada,10)?!0:!1},TarjetasDebitoCtrl.prototype.getGestion=function(gestion){return self.listaGestiones[gestion]},TarjetasDebitoCtrl.prototype.obtenerDatosClienteSesion=function(){self.contextoCliente.getInfoClienteDesdeSesion().then(function(cliente){self.listaCorreos=angular.copy(cliente.data.informacionBasica.correosCliente)},function(){self.isErrorListar=!1})},TarjetasDebitoCtrl.prototype.tieneGestiones=function(gestiones){var _permisosGestiones=[];return _.each(gestiones,function(gestion){self.listaGestiones[gestion].hasOwnProperty("permisos")&&(_permisosGestiones=_.union(_permisosGestiones,self.listaGestiones[gestion].permisos))}),_.intersection(_permisosGestiones,self.permisosEjecutivo).length?!0:!1},TarjetasDebitoCtrl.prototype.tienePermisoVisualizacion=function(){var _permisoVisualizacion=["ROLE_PVTTARJDEBIT_CONSULTAR"];return _.intersection(_permisoVisualizacion,self.permisosEjecutivo).length?!0:!1},TarjetasDebitoCtrl.prototype.obtenerPermisosEjecutivo=function(){var _perfil;self.perfilUsuarioService.perfilIsLoaded()&&(_perfil=self.perfilUsuarioService.getPerfilActual()),self.permisosEjecutivo=_perfil.permisos?_perfil.permisos:[]}}(),function(){function TarjetasDebitoFactory(URL_API,$http){var factory={};return factory.getTarjetasDebito=function(numeroCuenta){return $http.get(URL_API+"/tarjeta-debito-cdn/query/getTarjetaDebito/"+numeroCuenta)},factory.getGrafica=function(numeroTarjeta,grafica){return $http.get(URL_API+"/tarjeta-debito-cdn/query/getGrafica/"+numeroTarjeta+"/"+grafica)},factory.crearAdicionalTarjeta=function(body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/crearAdicionalTarjetaDebito",body)},factory.activarTarjeta=function(body){return $http.patch(URL_API+"/tarjeta-debito-cdn/transaction/activarTarjeta",body)},factory.resetearTarjeta=function(body){return $http.patch(URL_API+"/tarjeta-debito-cdn/transaction/SolicitudPin",body)},factory.anularTarjeta=function(body){return $http.patch(URL_API+"/tarjeta-debito-cdn/transaction/anularTarjetaDebito",body)},factory.cerrarTarjeta=function(body){return $http.patch(URL_API+"/tarjeta-debito-cdn/transaction/cerrarTarjetaDebito",body)},factory.reemitirTarjeta=function(body){return $http.patch(URL_API+"/tarjeta-debito-cdn/transaction/reemitirTarjetaDebito",body)},factory.getPDFActivar=function(body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/activarTarjetaPDF",body,{responseType:"arraybuffer"})},factory.getPDFResetear=function(body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/solicitudPinPDF",body,{responseType:"arraybuffer"})},factory.getPDFAnular=function(body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/anulacionPDF",body,{responseType:"arraybuffer"})},factory.getPDFCerrar=function(body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/cerrarPDF",body,{responseType:"arraybuffer"})},factory.sendMailActivar=function(mail,body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/activarTarjetaEmail/"+mail+"/",body)},factory.sendMailResetear=function(mail,body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/solicitudPinEmail/"+mail+"/",body)},factory.sendMailAnular=function(mail,body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/anulacionEmail/"+mail+"/",body)},factory.sendMailCerrar=function(mail,body){return $http.post(URL_API+"/tarjeta-debito-cdn/transaction/cerrarEmail/"+mail+"/",body)},factory}angular.module("WebBancoChile.servCuenta").factory("TarjetasDebitoFactory",TarjetasDebitoFactory),TarjetasDebitoFactory.$inject=["URL_API","$http"]}(),function(){function asideDetalleTransferenciaCtrl($scope,$rootScope,$modalInstance,transferencia){vm=this,vm.modalInstance=$modalInstance,vm.transferencia=transferencia}angular.module("WebBancoChile.servCuenta").controller("AsideDetalleTransferenciaCtrl",asideDetalleTransferenciaCtrl);var vm;asideDetalleTransferenciaCtrl.$inject=["$scope","$rootScope","$modalInstance","transferencia"],asideDetalleTransferenciaCtrl.prototype.ok=function(){vm.modalInstance.close()},asideDetalleTransferenciaCtrl.prototype.cancel=function(){vm.modalInstance.dismiss("cancel")}}(),function(){angular.module("WebBancoChile.servCuenta").controller("AsideTransferenciaEnvioEmailCtrl",function($scope,$rootScope,$modalInstance,$injector,filterData){function activate(){null!=filterData.informacionBasica.correosCliente&&filterData.informacionBasica.correosCliente.length>0?angular.forEach(filterData.informacionBasica.correosCliente,function(value,key){vm.emailList[key]={valor:value,id:key}}):vm.mensajeAlerta={code:0,message:"El cliente no tiene correos registrados, se debe actualizar datos de contactabilidad",severity:"information",show:!0}}function sendMail(){var sendObj={numProducto:filterData.numProducto,year:filterData.anio,month:filterData.mes,rutCliente:filterData.rutCliente,tipoCartola:filterData.tipoCartola,marca:filterData.marca,mail:vm.email};vm.email={valor:"",id:""},asideTransferenciaEnvioEmailFactory.sendMail(sendObj).then(function(data){vm.mensajeAlerta={code:0,message:data.mensaje,severity:"success",show:!0}},function(err){vm.mensajeAlerta={code:0,message:err.message,severity:err.type,show:!0}})}function cancel(){vm.modalInstance.dismiss("cancel")}var vm=this,asideTransferenciaEnvioEmailFactory=$injector.get("AsideTransferenciaEnvioEmailFactory");angular.extend(vm,{modalInstance:$modalInstance,mensajeAlerta:{code:0,message:"",severity:"",show:!1},emailList:[],email:{valor:"",id:""},sendMail:sendMail,cancel:cancel}),activate()})}(),function(){function asideTransferenciaEnvioEmailFactory($http,$q,URL_API,CONTEXT_CONSULTA_TRANSFERENCIAS,CuentaService){function sendMail(obj){var deferred=$q.defer();return $http.post(URL_API+CONTEXT_CONSULTA_TRANSFERENCIAS+"/mail/sendCartolaTef",obj).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}var service={sendMail:sendMail};return service}angular.module("WebBancoChile.servCuenta").factory("AsideTransferenciaEnvioEmailFactory",asideTransferenciaEnvioEmailFactory),asideTransferenciaEnvioEmailFactory.$inject=["$http","$q","URL_API","CONTEXT_CONSULTA_TRANSFERENCIAS","CuentaService"]}(),function(){for(var meses=[{nombre:"Enero",value:"01"},{nombre:"Febrero",value:"02"},{nombre:"Marzo",value:"03"},{nombre:"Abril",value:"04"},{nombre:"Mayo",value:"05"},{nombre:"Junio",value:"06"},{nombre:"Julio",value:"07"},{nombre:"Agosto",
value:"08"},{nombre:"Septiembre",value:"09"},{nombre:"Octubre",value:"10"},{nombre:"Noviembre",value:"11"},{nombre:"Diciembre",value:"12"}],anios=[],cantAnios=6,i=0;cantAnios>i;i++){var temp={nombre:moment().year()-i};anios.push(temp)}angular.module("WebBancoChile.constantsTransferencias",[]).constant("CONSTANTE_MESES",meses).constant("CONSTANTE_ANIOS",anios).constant("CONTEXT_CONSULTA_TRANSFERENCIAS","/servicios-cartola-tef")}(),function(){angular.module("WebBancoChile.servCuenta").controller("TransferenciasController",function($scope,$filter,$injector,$modal){function asideDetalleTransferencia(htmlName,size,transferencia){var asideUrl="components/cuenta/transferencias/"+htmlName+".html",asideResolve={transferencia:transferencia},modalInstance=$modal.open({templateUrl:asideUrl,controller:"AsideDetalleTransferenciaCtrl",controllerAs:"aside",resolve:asideResolve,size:size,animation:!0,windowClass:"modal-detalle",backdrop:!0});modalInstance.result.then()}function asideTransferenciaEnvioEmail(htmlName,size){var asideUrl="components/cuenta/transferencias/"+htmlName+".html",asideResolve={filterData:function(){return{numProducto:cc.cuentaTemp.numProducto,mes:vm.mes.value,anio:vm.anio.nombre,rutCliente:cc.cliente.rutCliente,tipoCartola:vm.tipoCartola,marca:cc.cliente.codigoMarca,informacionBasica:cc.cliente.informacionBasica}}},modalInstance=$modal.open({templateUrl:asideUrl,controller:"AsideTransferenciaEnvioEmailCtrl",controllerAs:"aside",resolve:asideResolve,size:size,animation:!0,windowClass:"modal-detalle",backdrop:!0});modalInstance.result.then()}function cambiaTipoCartola(envRec){vm.tipoCartola=envRec}function buscarTransferencias(){vm.loading=!0,vm.message={success:"",error:""},limpiarGrillaTransferencias(),TransferenciasFactory.getTransferencias(cc.cuentaTemp.numProducto,vm.anio.nombre,vm.mes.value,cc.rutCliente).then(function(rs){vm.listaTefE.set(filtraTransferencia(rs.data,"E")),vm.listaTefR.set(filtraTransferencia(rs.data,"R")),vm.loading=!1},function(err){vm.message.error=err.data,vm.loading=!1})}function getPDF(){vm.message={success:"",error:""},TransferenciasFactory.getPDFFact(cc.cuentaTemp.numProducto,vm.anio.nombre,vm.mes.value,cc.rutCliente,vm.tipoCartola,cc.codigoMarca).then(function(response){UtilidadesFactory.getFechaServer().then(function(rs){var appendName=rs.fechaformatoSinpuntos,blob=new Blob([response.data],{type:"application/pdf"});saveAs(blob,"CartolaTEF_"+cc.rutCliente.replace("-","_")+"_"+appendName+".pdf")},function(){vm.message.error=data})},function(){vm.message.error=data})}function filtraTransferencia(lista,tipoCartola){return _.filter(lista,function(transferencias){return transferencias.tipoCartola===tipoCartola}).map(function(transferencias,key){return transferencias.id=key,transferencias.fechaTransaccion=$filter("date")(transferencias.fechaTransaccion,"dd/MM/yyyy"),transferencias.rutDestino=$filter("rut")(transferencias.rutDestino),transferencias.rutOrigen=$filter("rut")(transferencias.rutOrigen),transferencias.monto=Number(transferencias.monto),transferencias})}function rePaginador(){vm.listaTefE.filter("filterPaginator",[vm.listaTefEFilter,vm.searchTextTef]),vm.listaTefR.filter("filterPaginator",[vm.listaTefRFilter,vm.searchTextTef])}function cargarSelectMesPorAnio(){var mesHasta=11;parseInt(vm.anio.nombre,10)>=moment().year()&&(mesHasta=moment().month());var mesesDestino=[];angular.extend(mesesDestino,CONSTANTE_MESES),vm.meses=mesesDestino.splice(0,mesHasta+1),vm.mes=vm.meses[vm.meses.length-1]}function limpiarGrillaTransferencias(){"function"==typeof vm.listaTefE.set&&vm.listaTefE.set([]),"function"==typeof vm.listaTefR.set&&vm.listaTefR.set([])}var vm=this,cc=$scope.$parent.$parent.$parent.cc,CONSTANTE_ANIOS=$injector.get("CONSTANTE_ANIOS"),CONSTANTE_MESES=$injector.get("CONSTANTE_MESES"),UtilidadesFactory=$injector.get("UtilidadesFactory"),TransferenciasFactory=$injector.get("TransferenciasFactory");angular.extend(vm,{message:{success:"",error:""},loading:!1,statusSearchTef:{isopenSearchTefE:!1,isopenSearchTefR:!1},tipoCartola:"E",searchTextTef:"",meses:CONSTANTE_MESES,mes:CONSTANTE_MESES[moment().month()],anios:CONSTANTE_ANIOS,anio:{nombre:moment().year()},listaTefE:{},listaTefR:{},listaTefEFilter:["fechaTransaccion","cuentaOrigen","cuentaDestino","nombreDestino","rutDestino","glosaBancoDestino","monto","estadoTransaccion"],listaTefRFilter:["fechaTransaccion","cuentaDestino","cuentaOrigen","nombreOrigen","rutOrigen","glosaBancoOrigen","monto","estadoTransaccion"],asideDetalleTransferencia:asideDetalleTransferencia,asideTransferenciaEnvioEmail:asideTransferenciaEnvioEmail,cambiaTipoCartola:cambiaTipoCartola,buscarTransferencias:buscarTransferencias,cargarSelectMesPorAnio:cargarSelectMesPorAnio,getPDF:getPDF,rePaginador:rePaginador}),cargarSelectMesPorAnio(),buscarTransferencias(),$scope.$watch(function(){return $scope.$parent.$parent.$parent.cc.cuentaTemp},function(newVal,oldVal){_.isEmpty(newVal)||_.isEmpty(oldVal)||oldVal.numProducto===newVal.numProducto||$state.go("saldo")})})}(),function(){function transferenciasFactory($http,$q,URL_API,CONTEXT_CONSULTA_TRANSFERENCIAS){function getTransferencias(numProducto,anio,mes,rutCliente){var obj={numProducto:numProducto,year:anio,month:mes,rutCliente:rutCliente,tipoCartola:"",marca:0},urlTef=URL_API+CONTEXT_CONSULTA_TRANSFERENCIAS+"/consulta/cartolasTef";return $http({url:urlTef,method:"post",data:JSON.stringify(obj),headers:{"Content-Type":"application/json"}})}function getPDFFact(numProducto,year,month,rutConsulta,tipoCartola,codigoMarca){var obj={numProducto:numProducto,year:year,month:month,rutCliente:rutConsulta,tipoCartola:tipoCartola,marca:codigoMarca},urlPdfFact=URL_API+CONTEXT_CONSULTA_TRANSFERENCIAS+"/descarga/cartolasTefPdf";return $http({url:urlPdfFact,method:"POST",data:JSON.stringify(obj),responseType:"arraybuffer",headers:{Accept:"application/pdf"}})}var service={getTransferencias:getTransferencias,getPDFFact:getPDFFact};return service}angular.module("WebBancoChile.servCuenta").factory("TransferenciasFactory",transferenciasFactory),transferenciasFactory.$inject=["$http","$q","URL_API","CONTEXT_CONSULTA_TRANSFERENCIAS"]}(),function(){function utilidadesFactory($http,$q,URL_API,CuentaService){function getFechaHoy(){var deferred=$q.defer();return $http.get(URL_API+"/consulta-producto-cliente/consulta/fechaHoy").success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}function getFechaServer(){var deferred=$q.defer();return $http.get(URL_API+"/consulta-producto-cliente/consulta/fechaHoyString").success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(CuentaService.errorHandler(err))}),deferred.promise}var service={getFechaHoy:getFechaHoy,getFechaServer:getFechaServer};return service}angular.module("WebBancoChile.servCuenta").factory("UtilidadesFactory",utilidadesFactory),utilidadesFactory.$inject=["$http","$q","URL_API","CuentaService"]}(),function(){function homeCtrl(){var vm=this;vm.isCollapsed=!0}angular.module("WebBancoChile.home").controller("homeCtrl",homeCtrl)}();
//# sourceMappingURL=bin/assets/taurus-serv-cuenta-1.8.0-build.12_app.js.map